<div class="p-p-4">
  <!-- Header -->
  <div class="p-d-flex p-jc-between p-ai-center p-mb-4">
    <div>
      <h1 class="p-m-0 p-text-bold">
        <i class="pi pi-users p-mr-2"></i>Cafeteria Members
      </h1>
      <p class="p-text-secondary p-mt-1 p-mb-0">Manage member registrations</p>
    </div>
    <div style="display: flex; gap: 0.5rem;">
      <button
        pButton
        type="button"
        label="Add Member"
        icon="pi pi-plus"
        (click)="openAddUser()"
        class="p-button-success"
      ></button>
      <button
        pButton
        type="button"
        label="Logout"
        icon="pi pi-sign-out"
        (click)="logout()"
        class="p-button-text"
      ></button>
    </div>
  </div>

  <p-toast></p-toast>

  <!-- Table Card -->
  <p-card>
    <!-- Table Actions (top-right) -->
    <div class="p-d-flex p-jc-end p-ai-center p-mb-2 table-actions">
      <p-splitButton
        label="Excel"
        icon="pi pi-file-excel"
        class="p-button-text"
        [model]="excelMenuItems"
      ></p-splitButton>
      <button
        pButton
        type="button"
        icon="pi pi-filter"
        label="Filters"
        class="p-button-text"
        (click)="toggleFilters()"
      ></button>
      <button
        pButton
        type="button"
        label="Clear"
        icon="pi pi-times"
        class="p-button-text"
        (click)="clearFilters()"
        [disabled]="loading || savingChanges"
      ></button>
      <button
        pButton
        type="button"
        label="Save Changes"
        icon="pi pi-save"
        (click)="savechanges()"
        [disabled]="loading || savingChanges"
        [loading]="savingChanges"
        class="p-button-primary"
      ></button>
    </div>

    <!-- Bulk Upload Dialog -->
    <p-dialog
      header="Excel Bulk Add/Edit"
      [(visible)]="bulkDialogVisible"
      [modal]="true"
      [style]="{ width: '980px', 'max-width': '96vw' }"
      (onHide)="onBulkDialogHide()"
    >
      <div class="bulk-dialog-content">
        <div class="p-mb-3">
          <p-steps [model]="bulkSteps" [activeIndex]="bulkStep - 1" [readonly]="true"></p-steps>
        </div>

        <!-- Step 1: select -->
        <div class="bulk-file-section">
          <div class="formgrid grid">
            <div class="field col-12">
              <label for="bulkExcelFile"><b>Select Excel file</b></label>
              <input
                #bulkFileInput
                id="bulkExcelFile"
                type="file"
                accept=".xlsx"
                (change)="onBulkFileSelected($event)"
                style="width:100%; max-width:100%;"
              />
              <small class="p-text-secondary p-d-block p-mt-1" style="font-size: 0.82rem;">
                Filename must start with <code>Users_Template_</code> (browser suffix like <code>(2)</code> is allowed).
              </small>
            </div>
          </div>

          <div class="bulk-file-selected" *ngIf="bulkFile">
            Selected: <b>{{ bulkFile.name }}</b>
          </div>
          <p-message *ngIf="bulkFileError" severity="warn" [text]="bulkFileError"></p-message>
        </div>

        <!-- Actions (always visible) -->
        <div class="bulk-actions-container">
            <button
              pButton
              type="button"
              label="Download Error Excel"
              icon="pi pi-file-excel"
              class="p-button-text p-button-sm"
              [disabled]="!bulkResult?.errorFileBase64"
              (click)="downloadValidationErrors()"
            ></button>
            <button
              pButton
              type="button"
              label="Validate"
              icon="pi pi-check"
              class="p-button-primary p-button-sm"
              [disabled]="!bulkFile || !!bulkFileError || bulkValidating || bulkUploading"
              [loading]="bulkValidating"
              (click)="validateBulk()"
            ></button>
            <button
              pButton
              type="button"
              label="Upload"
              icon="pi pi-cloud-upload"
              class="p-button-success p-button-sm"
              [disabled]="!bulkFile || !!bulkFileError || bulkUploading || bulkValidating"
              [loading]="bulkUploading"
              (click)="uploadBulk()"
            ></button>
        </div>

        <!-- Step 2: errors -->
        <div class="p-mt-4" *ngIf="bulkErrorRows?.length">
          <p-message severity="error" [text]="'Found ' + bulkErrorRows.length + ' error rows. Fix and re-upload.'"></p-message>
          <p-table [value]="bulkErrorRows" responsiveLayout="scroll" styleClass="p-datatable-sm p-mt-2">
            <ng-template pTemplate="header">
              <tr>
                <th style="width: 120px;">Row</th>
                <th>Error Reason</th>
              </tr>
            </ng-template>
            <ng-template pTemplate="body" let-e>
              <tr>
                <td>{{ e.rowNumber }}</td>
                <td>{{ e.reason }}</td>
              </tr>
            </ng-template>
          </p-table>
        </div>

        <!-- Step 3: results -->
        <div class="p-mt-4" *ngIf="bulkResult && !bulkErrorRows?.length">
          <p-message severity="success" [text]="'Validation passed. You can upload now.'"></p-message>
        </div>
      </div>
    </p-dialog>

    <!-- Filter Bar -->
    <div *ngIf="showFilters" class="p-fluid p-mb-3">
      <div class="formgrid grid">
        <div class="field col-12 md:col-3">
          <label for="filterName">Name</label>
          <input
            id="filterName"
            pInputText
            type="text"
            placeholder="Search by name"
            [(ngModel)]="filterModel.name"
            (ngModelChange)="applyLocalFilters()"
            autocomplete="off"
          />
        </div>

        <div class="field col-12 md:col-2">
          <label for="filterState">State</label>
          <p-dropdown
            id="filterState"
            [options]="stateFilterOptions"
            [(ngModel)]="filterModel.state"
            (onChange)="applyLocalFilters()"
            [showClear]="true"
            placeholder="All States"
          ></p-dropdown>
        </div>

        <div class="field col-12 md:col-2">
          <label for="filterCity">City</label>
          <p-dropdown
            id="filterCity"
            [options]="getFilterCityOptions()"
            [(ngModel)]="filterModel.city"
            (onChange)="applyLocalFilters()"
            [showClear]="true"
            placeholder="All Cities"
          ></p-dropdown>
        </div>

        <div class="field col-12 md:col-2">
          <label for="filterGender">Gender</label>
          <p-dropdown
            id="filterGender"
            [options]="genderFilterOptions"
            [(ngModel)]="filterModel.gender"
            (onChange)="applyLocalFilters()"
            [showClear]="true"
            placeholder="All Genders"
          ></p-dropdown>
        </div>

        <div class="field col-12 md:col-3">
          <label for="filterTech">Tech Interests</label>
          <p-multiSelect
            id="filterTech"
            [options]="techOptions"
            [(ngModel)]="filterModel.techInterests"
            (onChange)="applyLocalFilters()"
            display="chip"
            defaultLabel="All Technologies"
          ></p-multiSelect>
        </div>
      </div>
    </div>

    <p-table
      #dt
      [value]="filteredUsers"
      [loading]="loading"
      [paginator]="true"
      [rows]="10"
      [showCurrentPageReport]="true"
      currentPageReportTemplate="Showing {first} to {last} of {totalRecords} members"
      [rowsPerPageOptions]="[5, 10, 25, 50]"
      [globalFilterFields]="['email', 'username', 'mobile', 'city', 'state', 'gender', 'address']"
      responsiveLayout="scroll"
      [rowHover]="true"
      dataKey="id"
      editMode="cell"
      [style]="{ 'table-layout': 'fixed' }"
      styleClass="p-datatable-sm"
    >
      <ng-template pTemplate="caption">
        <div class="p-d-flex p-jc-between p-ai-center">
          <span class="p-text-bold">Member Directory</span>
          <span class="p-input-icon-left">
            <i class="pi pi-search"></i>
            <input 
              pInputText 
              type="text" 
              (input)="dt.filterGlobal($any($event.target).value, 'contains')"
              placeholder="Search members..."
              autocomplete="off"
            />
          </span>
        </div>
      </ng-template>

      <ng-template pTemplate="header">
        <tr>
          <th pSortableColumn="email" style="width: 12%; padding: 0.75rem;">Email <p-sortIcon field="email"></p-sortIcon></th>
          <th pSortableColumn="username" style="width: 8%; padding: 0.75rem;">Username <p-sortIcon field="username"></p-sortIcon></th>
          <th style="width: 7%; padding: 0.75rem;">Mobile</th>
          <th style="width: 8%; padding: 0.75rem;">Credit Card</th>
          <th pSortableColumn="state" style="width: 7%; padding: 0.75rem;">State <p-sortIcon field="state"></p-sortIcon></th>
          <th pSortableColumn="city" style="width: 7%; padding: 0.75rem;">City <p-sortIcon field="city"></p-sortIcon></th>
          <th style="width: 6%; padding: 0.75rem;">Gender</th>
          <th style="width: 8%; padding: 0.75rem;">Hobbies</th>
          <th style="width: 8%; padding: 0.75rem;">Tech Interests</th>
          <th style="width: 9%; padding: 0.75rem;">Address</th>
          <th pSortableColumn="dob" style="width: 8%; padding: 0.75rem;">DOB <p-sortIcon field="dob"></p-sortIcon></th>
          <th style="width: 5%; padding: 0.75rem;">Actions</th>
        </tr>
      </ng-template>

      <ng-template pTemplate="body" let-user let-rowIndex="rowIndex">
        <tr>
          <td pEditableColumn field="email" (onEditComplete)="celledited($event)" style="word-wrap: break-word; word-break: break-word; white-space: normal; padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <input 
                    pInputText 
                    [(ngModel)]="user.email" 
                    (blur)="celledited({ data: user, field: 'email' })"
                    [class.ng-invalid]="hasFieldError(user.id, 'email')"
                    type="email"
                    placeholder="email@example.com"
                    autocomplete="off"
                  />
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'email')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'email') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span *ngIf="hasValue(user.email)" class="p-d-flex p-ai-center" [pTooltip]="getTooltipText(user.email, 30)" tooltipPosition="top">
                  <i class="pi pi-envelope p-mr-2" style="color: #6c757d;"></i>
                  <span style="display: inline-block; max-width: 100%;">{{ user.email }}</span>
                </span>
                <span *ngIf="!hasValue(user.email)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="username" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <input 
                    pInputText 
                    [(ngModel)]="user.username" 
                    (blur)="celledited({ data: user, field: 'username' })"
                    [class.ng-invalid]="hasFieldError(user.id, 'username')"
                    placeholder="4-20 characters"
                    autocomplete="off"
                  />
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'username')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'username') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <p-tag *ngIf="hasValue(user.username)" [value]="user.username" severity="info"></p-tag>
                <span *ngIf="!hasValue(user.username)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="mobile" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <input 
                    pInputText 
                    [(ngModel)]="user.mobile" 
                    (blur)="celledited({ data: user, field: 'mobile' })"
                    [class.ng-invalid]="hasFieldError(user.id, 'mobile')"
                    placeholder="10-digit number"
                    maxlength="10"
                    autocomplete="off"
                  />
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'mobile')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'mobile') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span *ngIf="hasValue(user.mobile)" class="p-d-flex p-ai-center">
                  <i class="pi pi-phone p-mr-2" style="color: #6c757d;"></i>
                  <span>{{ user.mobile }}</span>
                </span>
                <span *ngIf="!hasValue(user.mobile)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="creditCard" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <input 
                    pInputText 
                    [(ngModel)]="user.creditCard" 
                    (blur)="celledited({ data: user, field: 'creditCard' })"
                    [class.ng-invalid]="hasFieldError(user.id, 'creditCard')"
                    placeholder="Last 4 digits or full 16-digit number"
                    maxlength="16"
                    autocomplete="off"
                  />
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'creditCard')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'creditCard') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span class="p-d-flex p-ai-center">
                  <i class="pi pi-credit-card p-mr-2" style="color: #6c757d;"></i>
                  <span class="p-text-muted" style="font-family: monospace; font-size: 0.9rem; letter-spacing: 0.5px;">{{ formatCreditCard(user.creditCard) }}</span>
                </span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="state" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <p-dropdown
                    [options]="states"
                    [(ngModel)]="user.state"
                    (onChange)="onStateChange(user); celledited({ data: user, field: 'state' })"
                    placeholder="Select state"
                    [showClear]="true"
                    [class.ng-invalid]="hasFieldError(user.id, 'state')"
                  ></p-dropdown>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'state')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'state') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span *ngIf="hasValue(user.state)">{{ user.state }}</span>
                <span *ngIf="!hasValue(user.state)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="city" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <p-dropdown
                    [options]="cityOptions(user.state)"
                    [(ngModel)]="user.city"
                    (onChange)="celledited({ data: user, field: 'city' })"
                    placeholder="Select city"
                    [showClear]="true"
                    [disabled]="!user.state"
                    [class.ng-invalid]="hasFieldError(user.id, 'city')"
                  ></p-dropdown>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'city')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'city') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span *ngIf="hasValue(user.city)">{{ user.city }}</span>
                <span *ngIf="!hasValue(user.city)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="gender" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <p-dropdown
                    [options]="genderOptions"
                    [(ngModel)]="user.gender"
                    (onChange)="celledited({ data: user, field: 'gender' })"
                    placeholder="Select gender"
                    [class.ng-invalid]="hasFieldError(user.id, 'gender')"
                  ></p-dropdown>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'gender')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'gender') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <p-tag *ngIf="hasValue(user.gender)" [value]="user.gender" [severity]="getGenderSeverity(user.gender)"></p-tag>
                <span *ngIf="!hasValue(user.gender)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="hobbies" (onEditComplete)="celledited($event)" style="word-wrap: break-word; word-break: break-word; white-space: normal; padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <p-multiSelect
                    [options]="hobbiesOptions"
                    [(ngModel)]="user.hobbies"
                    (onChange)="celledited({ data: user, field: 'hobbies' })"
                    display="chip"
                    defaultLabel="Select hobbies"
                    [class.ng-invalid]="hasFieldError(user.id, 'hobbies')"
                  ></p-multiSelect>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'hobbies')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'hobbies') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <div *ngIf="formatArray(user.hobbies).length" class="p-d-flex p-flex-wrap" style="gap: 0.25rem;">
                  <p-chip *ngFor="let hobby of formatArray(user.hobbies)" [label]="hobby"></p-chip>
                </div>
                <span *ngIf="!formatArray(user.hobbies).length" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="techInterests" (onEditComplete)="celledited($event)" style="word-wrap: break-word; word-break: break-word; white-space: normal; padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <p-multiSelect
                    [options]="techOptions"
                    [(ngModel)]="user.techInterests"
                    (onChange)="celledited({ data: user, field: 'techInterests' })"
                    display="chip"
                    defaultLabel="Select tech"
                    [class.ng-invalid]="hasFieldError(user.id, 'techInterests')"
                  ></p-multiSelect>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'techInterests')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'techInterests') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <div *ngIf="formatArray(user.techInterests).length" class="p-d-flex p-flex-wrap" style="gap: 0.25rem;">
                  <p-chip *ngFor="let tech of formatArray(user.techInterests)" [label]="tech"></p-chip>
                </div>
                <span *ngIf="!formatArray(user.techInterests).length" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="address" (onEditComplete)="celledited($event)" style="word-wrap: break-word; word-break: break-word; white-space: normal; padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <textarea
                    pInputTextarea
                    rows="2"
                    [(ngModel)]="user.address"
                    (blur)="celledited({ data: user, field: 'address' })"
                    [class.ng-invalid]="hasFieldError(user.id, 'address')"
                    placeholder="Address"
                    autocomplete="off"
                  ></textarea>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'address')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'address') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span *ngIf="hasValue(user.address)" class="p-d-flex p-ai-center" [pTooltip]="getTooltipText(user.address, 40)" tooltipPosition="top">
                  <i class="pi pi-map-marker p-mr-2" style="color: #6c757d;"></i>
                  <span style="display: inline-block; max-width: 100%; line-height: 1.5;">{{ user.address }}</span>
                </span>
                <span *ngIf="!hasValue(user.address)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td pEditableColumn field="dob" (onEditComplete)="celledited($event)" style="padding: 0.75rem; vertical-align: top;">
            <p-cellEditor>
              <ng-template pTemplate="input">
                <div>
                  <p-calendar
                    [(ngModel)]="user.dob"
                    (onSelect)="celledited({ data: user, field: 'dob' })"
                    dateFormat="yy-mm-dd"
                    inputId="dob-{{ user.id || rowIndex }}"
                    [maxDate]="todayDate"
                    [showIcon]="true"
                    appendTo="body"
                    [class.ng-invalid]="hasFieldError(user.id, 'dob')"
                  ></p-calendar>
                  <small class="p-error p-d-block" *ngIf="hasFieldError(user.id, 'dob')" style="font-size: 0.75rem; margin-top: 0.25rem;">
                    {{ getFieldError(user.id, 'dob') }}
                  </small>
                </div>
              </ng-template>
              <ng-template pTemplate="output">
                <span *ngIf="hasValue(user.dob)" class="p-d-flex p-ai-center">
                  <i class="pi pi-calendar p-mr-2" style="color: #007bff;"></i>
                  <span class="p-text-primary" style="font-weight: 500;">{{ formatDateOnly(user.dob) }}</span>
                </span>
                <span *ngIf="!hasValue(user.dob)" class="p-text-secondary">-</span>
              </ng-template>
            </p-cellEditor>
          </td>
          <td style="padding: 0.75rem; vertical-align: top; white-space: nowrap;">
            <button pButton pRipple type="button" icon="pi pi-trash" class="p-button-rounded p-button-text p-button-danger" (click)="deleteUser(user)" pTooltip="Delete" tooltipPosition="top"></button>
          </td>
        </tr>
      </ng-template>

      <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="12" class="p-text-center p-py-5">
            <i class="pi pi-inbox" style="font-size: 3rem; color: #dee2e6;"></i>
            <h4 class="p-mt-3 p-mb-2">No members found</h4>
            <p class="p-text-secondary">Add your first member to get started</p>
            <button
              pButton
              type="button"
              label="Add Member"
              icon="pi pi-plus"
              (click)="openAddUser()"
              class="p-button-sm p-mt-2"
            ></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </p-card>

  <!-- Delete Confirmation Dialog (PrimeNG) -->
  <p-dialog
    [(visible)]="displayDeleteDialog"
    [modal]="true"
    [draggable]="false"
    [resizable]="false"
    [closable]="true"
    header="Confirm Delete"
    (onHide)="cancelDelete()"
    [style]="{ width: '420px' }"
  >
    <div class="p-d-flex p-ai-start" style="gap: 0.75rem;">
      <i class="pi pi-exclamation-triangle" style="font-size: 1.5rem; color: #d9534f; margin-top: 0.25rem;"></i>
      <div>
        <div style="font-weight: 600; margin-bottom: 0.25rem;">
          Are you sure you want to delete this user?
        </div>
        <div class="p-text-secondary">
          {{ userToDelete?.name ? ('User: ' + userToDelete?.name) : '' }}
        </div>
      </div>
    </div>

    <ng-template pTemplate="footer">
      <button pButton type="button" label="Cancel" class="p-button-text" (click)="cancelDelete()"></button>
      <button pButton type="button" label="Delete" icon="pi pi-trash" class="p-button-danger" [disabled]="loading" (click)="confirmDelete()"></button>
    </ng-template>
  </p-dialog>

  <!-- Add Dialog -->
  <p-dialog
    [(visible)]="displayAddDialog"
    [modal]="true"
    [style]="{ width: '800px' }"
    [maximizable]="true"
    [draggable]="false"
    [resizable]="false"
    header="Add New Member"
    (onHide)="onDialogHide()"
    [contentStyle]="{ 'max-height': '70vh', 'overflow-y': 'auto' }"
  >
    <app-user-form
      [user]="null"
      (saved)="onUserSaved()"
      (cancelled)="onDialogHide()"
    ></app-user-form>
  </p-dialog>
</div>