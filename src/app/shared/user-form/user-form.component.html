<form [formGroup]="userForm" (ngSubmit)="onSubmit()" autocomplete="off">
  <div class="p-fluid formgrid grid">
    
    <!-- Name -->
    <div class="field col-12 md:col-6">
      <label for="name">Name <span class="p-error">*</span></label>
      <input id="name" type="text" pInputText formControlName="name" placeholder="Full name" autocomplete="off" />
      <small class="p-error" *ngIf="f.name.touched && f.name.errors">
        <span *ngIf="f.name.errors?.['required']">Name is required</span>
        <span *ngIf="f.name.errors?.['minlength']">Name must be at least 2 characters</span>
        <span *ngIf="f.name.errors?.['hasNumbers']">Name cannot contain numbers</span>
      </small>
    </div>

    <!-- Email -->
    <div class="field col-12 md:col-6">
      <label for="email">Email <span class="p-error">*</span></label>
      <input id="email" type="email" pInputText formControlName="email" placeholder="email@example.com" autocomplete="off" />
      <small class="p-error" *ngIf="f.email.touched && f.email.errors">
        <span *ngIf="f.email.errors?.['required']">Email is required</span>
        <span *ngIf="f.email.errors?.['email'] || f.email.errors?.['invalidEmail']">Please enter a valid email address with a valid domain extension (e.g., .com, .org, .net)</span>
      </small>
    </div>

    <!-- Mobile -->
    <div class="field col-12 md:col-6">
      <label for="mobile">Mobile <span class="p-error">*</span></label>
      <input id="mobile" type="text" pInputText formControlName="mobile" placeholder="10-digit number" maxlength="10" autocomplete="off" />
      <small class="p-error" *ngIf="f.mobile.touched && f.mobile.errors">
        <span *ngIf="f.mobile.errors?.['required']">Mobile number is required</span>
        <span *ngIf="f.mobile.errors?.['pattern']">Mobile must be exactly 10 digits</span>
      </small>
    </div>

    <!-- Credit Card -->
    <div class="field col-12 md:col-6">
      <label for="creditCard">Credit Card <span class="p-error">*</span></label>
      <input id="creditCard" type="text" pInputText formControlName="creditCard" placeholder="16 digits or last 4 digits" maxlength="16" autocomplete="off" />
      <small class="p-error" *ngIf="f.creditCard.touched && f.creditCard.errors">
        <span *ngIf="f.creditCard.errors?.['required']">Credit card number is required</span>
        <span *ngIf="f.creditCard.errors?.['pattern']">Credit card must be 16 digits or last 4 digits</span>
      </small>
    </div>

    <!-- State -->
    <div class="field col-12 md:col-6">
      <label for="state">State <span class="p-error">*</span></label>
      <p-dropdown id="state" [options]="states" formControlName="state" placeholder="Select state" [showClear]="true"></p-dropdown>
      <small class="p-error" *ngIf="f.state.touched && f.state.errors">
        <span *ngIf="f.state.errors?.['required']">State is required</span>
      </small>
    </div>

    <!-- City -->
    <div class="field col-12 md:col-6">
      <label for="city">City <span class="p-error">*</span></label>
      <p-dropdown id="city" [options]="cities" formControlName="city" placeholder="Select city" [showClear]="true" [disabled]="!f.state.value"></p-dropdown>
      <small class="p-error" *ngIf="f.city.touched && f.city.errors">
        <span *ngIf="f.city.errors?.['required']">City is required</span>
      </small>
    </div>

    <!-- Gender -->
    <div class="field col-12 md:col-6">
      <label>Gender <span class="p-error">*</span></label>
      <div class="flex flex-wrap gap-3 mt-2">
        <div class="field-radiobutton" *ngFor="let g of ['Male','Female','Other']">
          <p-radioButton [inputId]="'gender-' + g" name="gender" [value]="g" formControlName="gender"></p-radioButton>
          <label [for]="'gender-' + g" class="ml-2">{{ g }}</label>
        </div>
      </div>
    </div>

    <!-- Hobbies -->
    <div class="field col-12 md:col-6">
      <label>Hobbies <span class="p-error">*</span></label>
      <div class="flex flex-wrap gap-3 mt-2">
        <div class="field-checkbox" *ngFor="let h of hobbiesOptions">
          <p-checkbox [inputId]="'hobby-' + h.value" [value]="h.value" formControlName="hobbies"></p-checkbox>
          <label [for]="'hobby-' + h.value" class="ml-2">{{ h.label }}</label>
        </div>
      </div>
      <small class="p-error" *ngIf="f.hobbies.touched && f.hobbies.errors">
        <span *ngIf="f.hobbies.errors?.['required']">Select at least one hobby</span>
      </small>
    </div>

    <!-- Tech Interests -->
    <div class="field col-12 md:col-6">
      <label for="techInterests">Tech Interests <span class="p-error">*</span></label>
      <p-multiSelect id="techInterests" [options]="techOptions" formControlName="techInterests" placeholder="Select technologies" [showHeader]="false"></p-multiSelect>
      <small class="p-error" *ngIf="f.techInterests.touched && f.techInterests.errors">
        <span *ngIf="f.techInterests.errors?.['required']">Select at least one technology</span>
      </small>
    </div>

    <!-- Address -->
    <div class="field col-12 md:col-6">
      <label for="address">Address</label>
      <textarea id="address" pInputTextarea rows="3" formControlName="address" placeholder="Full address" autocomplete="off"></textarea>
      <small class="p-error" *ngIf="f.address.touched && f.address.errors">
        <span *ngIf="f.address.errors?.['pattern']">Address can contain letters, numbers, spaces and , . _ - only</span>
      </small>
    </div>

    <!-- Username -->
    <div class="field col-12 md:col-6">
      <label for="username">Username <span class="p-error">*</span></label>
      <input id="username" type="text" pInputText formControlName="username" placeholder="4-20 characters" [disabled]="isEditMode" autocomplete="off" />
      <small class="p-error" *ngIf="f.username.touched && f.username.errors">
        <span *ngIf="f.username.errors?.['required']">Username is required</span>
        <span *ngIf="f.username.errors?.['pattern']">Username must be 4-20 characters (letters, numbers, _, -, . only)</span>
      </small>
    </div>

    <!-- DOB -->
    <div class="field col-12 md:col-6">
      <label for="dob">Date of Birth <span class="p-error">*</span></label>
      <input id="dob" type="date" pInputText formControlName="dob" [attr.max]="todayDateStr" autocomplete="off" />
      <small class="p-error" *ngIf="f.dob.touched && f.dob.errors">
        <span *ngIf="f.dob.errors?.['required']">Date of birth is required</span>
      </small>
    </div>

    <!-- Password (Add Mode Only) -->
    <div class="field col-12 md:col-6" *ngIf="!isEditMode">
      <label for="password">Password <span class="p-error">*</span></label>
      <p-password id="password" formControlName="password" [feedback]="true" [toggleMask]="true" placeholder="Min 8 characters" styleClass="w-full" [inputStyle]="{ width: '100%' }"></p-password>
      <small class="p-error" *ngIf="f.password.touched && f.password.errors">
        <span *ngIf="f.password.errors?.['required']">Password is required</span>
        <span *ngIf="f.password.errors?.['minlength']">Password must be at least 8 characters</span>
        <span *ngIf="f.password.errors?.['pattern']">Password must contain uppercase, lowercase, number, and special character</span>
      </small>
    </div>

    <!-- Confirm Password (Add Mode Only) -->
    <div class="field col-12 md:col-6" *ngIf="!isEditMode">
      <label for="confirmPassword">Confirm Password <span class="p-error">*</span></label>
      <p-password id="confirmPassword" formControlName="confirmPassword" [feedback]="false" [toggleMask]="true" placeholder="Re-enter password" styleClass="w-full" [inputStyle]="{ width: '100%' }"></p-password>
      <small class="p-error" *ngIf="userForm.errors?.['mismatch'] && (f.confirmPassword.touched || f.password.touched)">
        Passwords must match
      </small>
    </div>

  </div>

  <!-- Actions -->
  <div class="flex justify-content-end mt-4 gap-2">
    <button pButton type="button" label="Cancel" icon="pi pi-times" class="p-button-text" (click)="onCancel()"></button>
    <button pButton type="submit" [label]="isEditMode ? 'Update' : 'Save'" [icon]="isEditMode ? 'pi pi-check' : 'pi pi-save'" [loading]="submitting" class="p-button-success"></button>
  </div>
</form>
